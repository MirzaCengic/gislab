#!/bin/bash
# Author Ivan Mincik, GISTA s.r.o., ivan.mincik@gmail.com

set -e


source /vagrant/config.cfg
if [ -f /vagrant/config-user.cfg ]
then
	source /vagrant/config-user.cfg
fi


# usage
function usage() {
	echo "USAGE: $(basename $0) [OPTIONS]"
	echo "Upgrade GIS.lab server and client software and configuration to latest versions available 
	for current GIS.lab installation. This command upgrades client environment by recreating client image
	from scratch using latest available software. Old client images are stored for 7 days in '/opt/ltsp/images'
	directory as a backups if something went wrong."
	echo -e "\nOPTIONS
	-h  display this help
	"
	exit 0
}


# options
FORCE="no"
while getopts "fh" OPTION
do
        case "$OPTION" in
			f) FORCE="yes" ;;
			h) usage ; exit 0 ;;
			\?) exit 1 ;;
        esac
done
shift $(($OPTIND - 1))

if [ "$FORCE" != "yes" ]; then
	echo "[GIS.lab]: You are going to upgrade server and client software. Please check if all clients are shut down !"
	echo "[GIS.lab]: Continue ? [ENTER to continue, CTRL-C to cancel]"
	read
fi


# perform upgrade
bash  /vagrant/system/install.sh


# vim: set ts=4 sts=4 sw=4 noet:
