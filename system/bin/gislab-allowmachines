#!/bin/bash

set -e

source $GISLAB_ROOT/functions.sh

# require root privileges
gislab_require_root


# usage
function usage() {
	echo "USAGE: $(basename $0) [OPTIONS] comma-separated-MAC-list"
	echo "Enable GIS.lab clients specified by comma separated list of MAC addresses."
	echo -e "\nOPTIONS
	-h  display this help
	"
	exit 255
}


# options
while getopts "h" OPTION
do
        case "$OPTION" in
			h) usage ;;
			\?) exit 1;;
        esac
done
shift $(($OPTIND - 1))
if [ $# -eq 0 ]; then usage; fi


# remove closing bracket of MACs list
sed -i '/^}/ d' /etc/dhcp/dhcpd-machines-allowed.conf

IFS=', ' read -a maclist <<< "$1"
for mac in "${maclist[@]}"
do
	echo $mac
	hostname=$(echo $mac | sed 's/://g')
	echo -e "  host $hostname { hardware ethernet $mac; }"  >> /etc/dhcp/dhcpd-machines-allowed.conf
done

# re-create closing bracket of MACs list
echo "}" >> /etc/dhcp/dhcpd-machines-allowed.conf

service isc-dhcp-server restart

gislab_print_info "Machines enabled"


# vim: set ts=4 sts=4 sw=4 noet:
