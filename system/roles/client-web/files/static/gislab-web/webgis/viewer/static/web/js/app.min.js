angular.module("gl.map",[]);
angular.module("gl.ui",["ngAnimate"]);
angular.module("gl.utils",[]);
angular.module("gl.features",["gl.map"]);
angular.module("gl.layersControl",["gl.map","gl.ui","gl.utils"]);
angular.module("gl.legend",["gl.map"]);
angular.module("gl.location",["gl.map"]);
!function(){"use strict";angular.module("gl.web",["ngMaterial","ui.layout","md.data.table","gl.ui","gl.utils","gl.map","gl.legend","gl.layersControl","gl.features"])}();
!function(){"use strict";function e(){function e(){}return e.prototype.layersTreeToList=function(e,r){var t=[],o=function(e,t,i){if(i||(i=0),t.title=t.title?t.title:t.name,t.depth=i,t.layers){!r&&t.title&&(t.isGroup=!0,e.push(t));var l=!0;t.layers.forEach(function(r){o(e,r,i+1),r.visible||(l=!1)}),t.visible=l}else t&&(t.isGroup=!1,e.push(t));return e};return o(t,e),t},e.prototype.createBaseLayer=function(e){var r;return"BLANK"===e.type?r=new ol.layer.Image({extent:e.extent,visible:e.visible}):"OSM"===e.type?r=new ol.layer.Tile({source:new ol.source.OSM,visible:e.visible||!1}):"WMS"===e.type&&(r=new ol.layer.Image({source:new ol.source.ImageWMS({url:e.url,resolutions:e.resolutions,params:{LAYERS:e.wms_layers.join(","),FORMAT:e.format,TRANSPARENT:"false"},serverType:"mapserver"}),extent:e.extent})),r&&(r.set("type","baselayer"),r.set("name",e.name)),r},e.prototype.createProjectLayer=function(e){var r;if(e.layers){var t=this.layersTreeToList({layers:e.layers},!0),o=[],i={},l={};t.forEach(function(e){e.visible&&o.push(e.name),l[e.name]=e.drawing_order;var r=e.attribution;if(r){var t;t=r.url?'<a href="{0}" target="_blank">{1}</a>'.format(r.url,r.title):r.title,i[e.name]=new ol.Attribution({html:t})}}),r=e.mapcache_url?new ol.layer.Tile({source:new ol.source.WebgisTileImage({project:e.project,tilesUrl:e.mapcache_url,legendUrl:e.legend_url,owsUrl:e.ows_url,projection:e.projection.code,tileGrid:new ol.tilegrid.TileGrid({origin:ol.extent.getBottomLeft(e.project_extent),resolutions:e.tile_resolutions,tileSize:256}),visibleLayers:o,layersAttributions:i,layersOrder:l}),extent:e.project_extent}):new ol.layer.Image({source:new ol.source.WebgisImageWMS({url:e.ows_url,visibleLayers:o,layersAttributions:i,layersOrder:l,params:{FORMAT:"image/png"},serverType:"qgis"}),extent:e.project_extent}),r.set("type","qgislayer"),r.set("name","qgislayer")}return r},e.prototype.createMap=function(e){-1===Object.keys(ol.proj.projections_).indexOf(e.projection.code)&&proj4.defs(e.projection.code,e.projection.proj4);var r=[],t=this.layersTreeToList({layers:e.base_layers},!0);t.forEach(function(e){var t=this.createBaseLayer(e);t&&r.push(t)},this);var o=this.createProjectLayer(e);o&&r.push(o);var i=new ol.Map({layers:r,view:new ol.View({projection:new ol.proj.Projection({code:e.projection.code,units:e.units}),resolutions:e.tile_resolutions,extent:e.project_extent}),controls:ol.control.defaults({attributionOptions:{collapsible:!0,label:"Â©"},rotate:!1}).extend([new ol.control.Rotate({})]),renderer:"canvas"});return i},new e}angular.module("gl.map").factory("mapBuilder",[e])}();
!function(){"use strict";function s(s){function e(){this.map=null,this.baseLayers={tree:{},list:[]},this.layers={tree:{},list:[]}}return e.prototype.load=function(e){this.config=e,this.map&&this.map.dispose(),e.base_layers=e.base_layers.filter(function(s){return"google"!==s.type}),this.baseLayers.tree=e.base_layers,this.baseLayers.list=s.layersTreeToList({layers:this.baseLayers.tree},!0),this.layers.tree=e.layers,this.layers.list=s.layersTreeToList({layers:this.layers.tree},!0);var i=this.baseLayers.list.some(function(s){return s.visible?!0:void 0});i||(this.baseLayers.list[0].visible=!0),this.layers.list.concat(this.baseLayers.list).forEach(function(s){s.isGroup||e.scales&&(angular.isDefined(s.visibility_scale_max)||(s.visibility_scale_max=e.scales[0]),angular.isDefined(s.visibility_scale_min)||(s.visibility_scale_min=e.scales[e.scales.length-1]))}),this.map=s.createMap(e)},new e}angular.module("gl.map").factory("projectProvider",["mapBuilder",s])}();
!function(){"use strict";function e(e,t){var r,l={},o={},a={};t.layers.list.forEach(function(e){var t={};e.attributes.forEach(function(e){t[e.name]={alias:e.alias,type:e.type}}),a[e.name]=t});var n=function(e){var r=new ol.layer.Vector({source:new ol.source.Vector({}),style:new ol.style.Style({stroke:new ol.style.Stroke({color:[250,250,25,.8],width:2}),fill:new ol.style.Fill({color:[250,250,25,.5]}),image:new ol.style.Circle({stroke:new ol.style.Stroke({color:[250,250,25,.8],width:2}),fill:new ol.style.Fill({color:[250,250,25,.5]}),radius:5})}),visible:!1});return r.set("name",e),l[e]=r,t.map.addLayer(r),r},s=function(e){var r=new ol.interaction.Select({condition:ol.events.condition.never,layers:[l[e]],style:new ol.style.Style({stroke:new ol.style.Stroke({color:[102,204,204,.8],width:3}),fill:new ol.style.Stroke({color:[102,204,204,.5]}),image:new ol.style.Circle({stroke:new ol.style.Stroke({color:[102,204,204,.8],width:2}),fill:new ol.style.Fill({color:[102,204,204,.5]}),radius:5})})});return o[e]=r,t.map.addInteraction(r),r};e.selectedFeature=null,e.selectFeature=function(t){e.selectedFeature=t,r.getFeatures().clear(),r.getFeatures().push(t)},e.getFeatureProperties=function(e){var t=e.getId(),r=t.substring(0,t.lastIndexOf(".")),l=a[r],o=[];return e.getKeys().forEach(function(t){t!==e.getGeometryName()&&"boundedBy"!==t&&o.push({key:t,label:l[t].alias||t})}),o},e.setFeaturesLayer=function(e){for(var a in l)l[a].setVisible(a===e);r=o[e]||s(e);for(var a in o)o[a].setActive(a===e),o[a].setMap(a===e?t.map:null)},e.setFeatures=function(t){r&&r.getFeatures().clear();for(var o in l)l[o].getSource().clear();if(t.length>0){var a={};t.forEach(function(e){if(e instanceof ol.Feature){var t=e.getId(),r=t.substring(0,t.lastIndexOf("."));a.hasOwnProperty(r)||(a[r]=[]),a[r].push(e)}});var s=[];for(var o in a){var i=l[o]||n(o);i.getSource().addFeatures(a[o]),s.push({layer:o,features:a[o]})}e.featuresCategories=s}else e.featuresCategories=null},e.features&&e.setFeatures(e.features),e.$on("$destroy",function(){for(var e in l)l[e].getSource().clear();for(var e in o)o[e].getFeatures().clear(),o[e].setMap(null)})}angular.module("gl.features").controller("FeaturesController",e),e.$inject=["$scope","projectProvider"]}();
!function(){"use strict";function e(e,a,s,i,t,r,l){function n(e,a){var i="",t=function(e){if(e.layers){i+="&nbsp;&nbsp;";var s=[];if(e.layers.forEach(function(e){var a=t(e);a&&s.push(a)}),i=i.slice(12),s.length>0)return i+'<label class="layer-group">'+e.title+"</label><br />"+s.join("")}else if(-1!=a.visible_overlays.indexOf(e.name))return"<span>"+i+"- "+e.title+"</span><br />"},r=[];return e.forEach(function(e){r.push(t(e))}),s.trustAsHtml(r.join("\n"))}e.topics=t.config.topics,e.selectedTopic={},e.topicDetail=function(e,a){e.detail||(console.log("topicDetail: "+e.title),e.detail={"abstract":e["abstract"],visibleLayers:n(t.layers.tree,e)},console.log("html generated"))},e.loadTopic=function(a){var s=e.topics[a];l.setVisibleLayers(t.map,s.visible_overlays),t.layers.list.forEach(function(e){e.visible=-1!=s.visible_overlays.indexOf(e.name)}),e.$broadcast("layersChanged")},e.setBaseLayer=function(e){t.map&&l.setBaseLayer(t.map,e)},e.getVisibleBaseLayer=function(){var e=l.getVisibleBaseLayer(t.map).get("name");return e},e.layersVisibilityChanged=function(){e.selectedTopic.index=null;var a=[];t.layers.list.forEach(function(e){!e.isGroup&&e.visible&&a.push(e.name)}),l.setVisibleLayers(t.map,a)},e.layers=t.layers.tree,e.baseLayers=t.baseLayers.tree}angular.module("gl.layersControl").controller("LayersController",e),e.$inject=["$scope","$timeout","$sce","$q","projectProvider","mapBuilder","layersControl"]}();
!function(){"use strict";function e(){function e(){}return e.prototype.getVisibleBaseLayer=function(e){var t;return e.getLayers().forEach(function(e){"baselayer"===e.get("type")&&e.getVisible()&&(t=e)}),t},e.prototype.setBaseLayer=function(e,t){e.getLayers().forEach(function(e){"baselayer"===e.get("type")&&(e.getVisible()&&e.get("name")!==t&&e.setVisible(!1),e.getVisible()||e.get("name")!==t||e.setVisible(!0))})},e.prototype.setVisibleLayers=function(e,t){var i=e.getLayer("qgislayer");i&&(t.length?i.getVisible()||i.setVisible(!0):i.setVisible(!1),i.getSource().setVisibleLayers(t))},e.prototype.getVisibleLayers=function(e){var t=e.getLayer("qgislayer");return t?t.getSource().getVisibleLayers():[]},new e}angular.module("gl.layersControl").factory("layersControl",[e])}();
!function(){"use strict";function e(e,r,n){e.layers=n.layers,e.updateLegendUrls=function(){var r=n.map.getLayer("qgislayer").getSource(),t=n.map.getView();e.layers.list.forEach(function(e){e.legendUrl=r.getLegendUrl(e.name,t)})},n.map&&e.updateLegendUrls()}angular.module("gl.legend").controller("LegendController",e),e.$inject=["$scope","$timeout","projectProvider"]}();
!function(){"use strict";function t(){function t(){this.watchID=null,this.autoPan=!1}return t.prototype._successHandler=function(t){var e=[t.coords.longitude,t.coords.latitude];"EPSG:4326"!==this.map.getView().getProjection().getCode()&&(e=ol.proj.transform(e,"EPSG:4326",this.map.getView().getProjection().getCode()));var o=this.locationFeature.getGeometry();if(o?o.setCoordinates(e):this.locationFeature.setGeometry(new ol.geom.Point(e)),this.autoPan){var a=ol.animation.pan({duration:300,source:this.map.getView().getCenter()});this.map.beforeRender(a),this.map.getView().setCenter(e)}},t.prototype._errorHandler=function(t){console.log(t)},t.prototype.activate=function(t,e){e=e||{timeout:2e4,enableHighAccuracy:!0,frequency:5e3},null!==this.watchID&&this.deactivate(),this.map=t;var o=t.getLayer("__location_layer");if(!o){console.log("creating location layer");var a=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"images/location.png"})}),i=new ol.Feature({});i.setStyle(a),o=new ol.layer.Vector({source:new ol.source.Vector({features:[i]})}),o.set("name","__location_layer"),t.addLayer(o),this.locationFeature=i}o.setVisible(!0),navigator.geolocation.getCurrentPosition(this._successHandler.bind(this),this._errorHandler.bind(this),e),this.watchID=navigator.geolocation.watchPosition(this._successHandler.bind(this),this._errorHandler.bind(this),e)},t.prototype.deactivate=function(t){null!==this.watchID&&(console.log("--------stopping GPS--------"),navigator.geolocation.clearWatch(this.watchID),this.watchID=null);var e=t.getLayer("__location_layer");e&&e.setVisible(!1)},t.prototype.setAutoPan=function(t){this.autoPan=t},new t}angular.module("gl.location").factory("locationService",[t])}();
!function(){"use strict";function e(e){e.collapseAccordion=function(e){var c=e.content,o=c[0].scrollHeight;e.expanded=!1,Velocity(c[0],{maxHeight:0,opacity:0},{duration:400,easing:"easeInBack",begin:function(){c.css("maxHeight",o+"px")}})},e.expandAccordion=function(e){var c=e.content,o=c[0].scrollHeight;e.expanded=!0,Velocity(c[0],{maxHeight:o,opacity:1},{duration:400,easing:"easeInBack",complete:function(){c.css("maxHeight","none")}})},e.toggleAccordion=function(c){c.independent||(e.selectedAccordion&&e.selectedAccordion!==c&&e.selectedAccordion.expanded&&e.collapseAccordion(e.selectedAccordion),e.selectedAccordion=c),c.expanded?e.collapseAccordion(c):e.expandAccordion(c)}}angular.module("gl.ui").controller("AccordionController",e),e.$inject=["$scope"]}();
!function(){"use strict";function e(e,n){e.collapseAccordion=function(e){var o=e.content,c=o[0].scrollHeight;e.expanded=!1,o.css("maxHeight",c+"px"),n.removeClass(o,"height-animation")},e.expandAccordion=function(e){var o=e.content;e.expanded=!0,n.addClass(o,"height-animation").then(function(){o.css("maxHeight","none")})},e.toggleAccordion=function(n){n.independent||(e.selectedAccordion&&e.selectedAccordion!==n&&e.selectedAccordion.expanded&&e.collapseAccordion(e.selectedAccordion),e.selectedAccordion=n),n.expanded?e.collapseAccordion(n):e.expandAccordion(n)}}angular.module("gl.ui").animation(".height-animation",function(){return{beforeAddClass:function(e,n,o,c){var i=e[0].scrollHeight;e.css("maxHeight",i+"px"),e.css("opacity","1"),o()},beforeRemoveClass:function(e,n,o){e[0].scrollHeight;e.css("maxHeight","0px"),e.css("opacity","0"),o()}}}).controller("AccordionController2",e),e.$inject=["$scope","$animate"]}();
!function(){"use strict";function o(o,e){o.collapseAccordion=function(o){var c=o.content,n=c[0].scrollHeight;o.expanded=!1,c.css("maxHeight",n+"px");var t=e(c,{from:{maxHeight:n+"px",opacity:1},to:{maxHeight:"0px",opacity:0},easing:"ease-out",duration:.4});t.start()},o.expandAccordion=function(o){var c=o.content;o.expanded=!0;var n=c[0].scrollHeight,t=e(c,{from:{maxHeight:"0px",opacity:0},to:{maxHeight:n+"px",opacity:1},easing:"ease-out",duration:.4});t.start().done(function(){c.css("maxHeight","none")})},o.toggleAccordion=function(e){e.independent||(o.selectedAccordion&&o.selectedAccordion!==e&&o.selectedAccordion.expanded&&o.collapseAccordion(o.selectedAccordion),o.selectedAccordion=e),e.expanded?o.collapseAccordion(e):o.expandAccordion(e)}}angular.module("gl.ui").controller("AccordionController3",o),o.$inject=["$scope","$animateCss"]}();
!function(){"use strict";function e(){return{scope:!0,controller:["$scope","$element",function(e,n){e.$accordion={elem:n,expanded:!1}}]}}function n(e){return{scope:!0,controller:["$scope","$element",function(e,n){e.$accordion={elem:n,expanded:!1,independent:!0}}],compile:function(e,n){return{pre:function(e,n,c){var o=e.$eval(c.glIndependentAccordion);angular.extend(e.$accordion,o)}}}}}function c(e){return{restrict:"A",controller:["$scope","$element",function(e,n){e.$accordion&&(e.$accordion.content=n)}],compile:function(e,n){return{pre:function(e,n,c){n.css("overflow","hidden"),n.css("minHeight","0"),e.$accordion.expanded||n.css("maxHeight",0)}}}}}angular.module("gl.ui").directive("glAccordion",e).directive("glIndependentAccordion",n).directive("glAccordionContent",c),n.$inject=["$parse"],c.$inject=["$parse"]}();
!function(){"use strict";function t(){return{restrict:"E",require:["glTabModel","glCarousel"],template:'<div class="carousel-slider-bg"><div class="carousel-slider"></div></div>',replace:!0,scope:!0,transclude:!1,controller:["$scope","$timeout","$parse",function(t,e,r){t.setupSlider=function(i,l,a){var n=i._getCarouselItemCount(),o=r(a),s=o.assign;t.$watch(a,function(t){i.setActiveCarouselItemIndex(t)});var c="{0}%".format(100/n);l.setAttribute("style","width: {width};".replace("{width}",c));var u="width: {width};						transform: translate3d({0}px, 0px, 0px);						-webkit-transform: translate3d({0}px, 0px, 0px);						-webkit-transition: all 0 ease 0".replace("{width}",c),d="width: {width};						transform: translate3d({0}px, 0px, 0px);						-webkit-transform: translate3d({0}px, 0px, 0px);						-webkit-transition: all 0.3s cubic-bezier(0.1, 0.7, 0.1, 1) 0s".replace("{width}",c);i.on("postchange",function(r){e(function(){s(t,r.activeIndex)},0);var a=i._scroll/n,o=d.format(a);l.setAttribute("style",o)}),i._hammer.on("drag",function(t){var e=i._getScrollDelta(t),r=(i._scroll-e)/n,a=u.format(r);l.setAttribute("style",a)}),i._hammer.on("dragend",function(t){var e=i._scroll/n,r=d.format(e);l.setAttribute("style",r)}),i.setActiveCarouselItemIndex(o(t))}}],link:function(t,e,r,i){setImmediate(function(){var i=t.$eval(r.glCarousel);t.setupSlider(i,e[0].children[0],r.glTabModel)})}}}angular.module("gl.ui").directive("glTabModel",function(){return{controller:["$scope",function(t){}]}}).directive("glCarousel",function(){return{controller:["$scope",function(t){}]}}).directive("glCarouselTabSlider",t)}();
!function(){"use strict";function t(){return{restrict:"A",controller:["$scope","$animate",function(t,i){t.setup=function(n,e){var o=!0;t.$watch(n,function(t){t?i.removeClass(e,"height-anim").then(function(){e.css("height","auto")}):i.addClass(e,"height-anim",{skip:o}),o=!1})}}],link:function(t,i,n,e){var o=n.glHeightAnimation||n.ngShow||n.ngHide||n.ngIf;t.setup(o,i)}}}function i(t){return{restrict:"A",compile:function(i,n){return i[0].setAttribute("style","display: block!important;visibility: hidden!important;"),{post:function(i,n,e){t(function(){var t=n[0].scrollHeight;n[0].setAttribute("style","height: {0}px".format(t))})}}}}}angular.module("gl.ui").animation(".height-anim",function(){return{beforeAddClass:function(t,i,n,e){var o=t[0].scrollHeight;e.skip?t.css("height","auto"):t.css("height","{0}px".format(o)),n()},beforeRemoveClass:function(t,i,n){var e=t[0].scrollHeight;t.css("height","{0}px".format(e)),n()}}}).directive("glHeightAnimation",t).directive("glFixedHeight",i),i.$inject=["$timeout"]}();
!function(){"use strict";function t(){return{restrict:"E",template:"<ng-transclude></ng-transclude>",require:"glOrientation",transclude:!0,replace:!0,scope:{},controller:["$scope","$timeout",function(t,e){t.setupIndicator=function(e,n,o){"top"===o?t.updateIndicator=function(){var t;t=e.scrollTop>20?1:e.scrollTop/20,n.setAttribute("style","opacity: {0};".format(t))}:"bottom"===o&&(t.updateIndicator=function(){var t,o=e.children[0].clientHeight-e.clientHeight-e.scrollTop;t=o>1?20>o?o/20:1:0,n.setAttribute("style","opacity: {0};".format(t))}),e.addEventListener("scroll",function(){t.updateIndicator()})}}],link:function(t,e,n,o){var r=e.parent().parent()[0],i=e[0];i.setAttribute("style","opacity: 0;"),t.setupIndicator(r,i,n.glOrientation),n.glUpdateOn?t.$parent.$watch(n.glUpdateOn,function(e){setTimeout(function(){t.updateIndicator()},5)}):setTimeout(function(){t.updateIndicator()},50)}}}function e(){return{restrict:"A",link:function(t,e,n,o){var r=parseInt(n.glScrollOffset)||0;e.on("focus",function(t,n){setTimeout(function(){for(var t=e[0].getBoundingClientRect().top,n=e[0].parentElement;"ONS-LIST"!==n.tagName;)n=n.parentElement;for(var o=n.parentElement;"ONS-SCROLLER"!==o.tagName;)o=o.parentElement;var t=e[0].getBoundingClientRect().top-n.getBoundingClientRect().top;o.scrollTop=t+r},500)})}}}angular.module("gl.ui").directive("glOrientation",function(){return{controller:["$scope",function(t){}]}}).directive("glScrollOffset",function(){return{controller:["$scope",function(t){}]}}).directive("glScrollIndicator",t).directive("glFocusAutoScroll",e)}();
!function(){"use strict";function e(){return{restrict:"A",scope:{rootNodes:"=glTreeView",idAttribute:"@glTreeIdAttribute",labelAttribute:"@glTreeLabelAttribute",childrenAttribute:"@glTreeChildrenAttribute",selectedValue:"@glTreeSelectedValue",groupTemplateId:"@glTreeGroupTpl",leafTemplateId:"@glTreeLeafTpl",changeHandler:"&glTreeViewChangeHandler"},transclude:!0,link:function(e,t,r,n,i){i(e,function(e){t.append(e)})},controller:["$scope",function(e){e.$node={data:null,parent:null,treeDepth:0,isGroup:!0,children:[]},e.$node.tree={root:e.$node,selectedValue:e.selectedValue?e.$parent.$eval(e.selectedValue):""},e.nodeSelected=function(t){e.changeHandler({value:t})}}]}}function t(){return{restrict:"A",scope:!0,transclude:!0,controller:["$scope","$compile","$element","$templateCache",function(e,t,r,n){e.buildHtml=function(){var i=e.$node.isGroup?e.groupTemplateId:e.leafTemplateId,l=n.get(i),d=angular.element(l);r.append(d),t(d)(e)}}],compile:function(e,t){return{pre:function(e,t,r){var n=e.$eval(r.glTreeNode);e.$node={data:n,treeDepth:e.$node?e.$node.treeDepth+1:1,isGroup:n.hasOwnProperty(e.childrenAttribute),parent:e.$parent.$node,tree:e.$parent.$node.tree,children:[]}},post:function(e,t,r){e.buildHtml();var n=e.$node.parent;n.children.push(e.$node)}}}}}function r(e,t,r){this.idAttribute=e,this.childrenAttribute=t,this.selectAttribute=r}function n(e,t){return{restrict:"A",scope:{rootNodes:"=glCheckTreeView",idAttribute:"@glTreeIdAttribute",selectAttribute:"@glTreeSelectedAttribute",childrenAttribute:"@glTreeChildrenAttribute",groupTemplateId:"@glTreeGroupTpl",leafTemplateId:"@glTreeLeafTpl",changeHandler:"&glTreeViewChangeHandler"},transclude:!0,link:function(e,r,n,i,l){l(e,function(e){r.append(e)}),n.glVar&&t(n.glVar).assign(e.$parent,e.treeView)},controller:["$scope",function(e){e.$node={data:null,parent:null,treeDepth:0,isGroup:!0,isExpanded:!0,isEnabled:!0,children:[]},e.$on("layersChanged",function(){e.treeView.syncWithModel(e.$node)}),e.nodeSelected=function(t){t.isGroup?e.treeView.setGroupVisibility(t):t.data[e.selectAttribute]=t.isChecked,e.changeHandler({node:t})},e.treeView=new r(e.idAttribute,e.childrenAttribute,e.selectAttribute)}]}}function i(){return{restrict:"A",scope:!0,controller:["$scope","$compile","$element","$templateCache",function(e,t,r,n){e.buildHtml=function(){var i=e.$node.isGroup?e.groupTemplateId:e.leafTemplateId,l=n.get(i),d=angular.element(l);r.append(d),t(d)(e)}}],compile:function(e,t){return{pre:function(e,t,r){var n=e.$eval(r.glCheckTreeNode),i=n.hasOwnProperty(e.childrenAttribute);i||angular.isDefined(n[e.selectAttribute])||(n[e.selectAttribute]=!1),e.$node={data:n,isGroup:i,treeDepth:e.$node?e.$node.treeDepth+1:1,isExpanded:!0,isChecked:n[e.selectAttribute],parent:e.$parent.$node,children:[]},i&&(e.$node.isEnabled=n[e.selectAttribute])},post:function(e,t,r){e.buildHtml();var n=e.$node.parent;n.children.push(e.$node)}}}}}angular.module("gl.ui").directive("glTreeView",e).directive("glTreeNode",t).directive("glCheckTreeView",n).directive("glCheckTreeNode",i),r.prototype.setGroupVisibility=function(e){e.isEnabled=e.parent.isEnabled&&e.isChecked,e.children.forEach(function(e){e.isGroup?this.setGroupVisibility(e):e.data[this.selectAttribute]=e.parent.isEnabled&&e.isChecked},this)},r.prototype.syncWithModel=function(e){var t=function(e){if(e.isGroup)e.children.forEach(t);else{var r=e.data[this.selectAttribute];if(r&&!e.parent.isEnabled)for(var n=e.parent;n&&!n.isEnabled;)n.data[this.selectAttribute]=!0,n.isChecked=!0,n.isEnabled=!0,n=e.parent;e.isChecked!=r&&(e.isChecked=r)}}.bind(this);t(e)},n.$inject=["$timeout","$parse"]}();
!function(){"use strict";function n(n){return{compile:function(i,t){var c=n(t.glClick);return function(n,i){i.on("click",function(i){n.$apply(function(){c(n,{$event:i})})})}}}}function i(){return{restrict:"A",link:function(n,i,t){i.on("click",function(n){window.open(t.glOpenInBrowser,"_system","location=yes")})}}}angular.module("gl.utils").directive("glClick",n).directive("glOpenInBrowser",i),n.$inject=["$parse"]}();
!function(){"use strict";function t(){return{restrict:"A",link:function(t,r,n){var i=t.$eval(n.glConAttr);for(var e in i)i[e]===!0&&n.$set(e,"true")}}}angular.module("gl.utils").directive("glConAttr",t)}();
!function(){"use strict";function t(t,e,o,i,n,a,r,l,c,s){t.tools=[{title:"Zoom to max extent",icon:"zoom-max",action:function(){var t=n.map,e=ol.animation.pan({duration:300,source:t.getView().getCenter()}),o=ol.animation.zoom({duration:300,resolution:t.getView().getResolution()});t.beforeRender(e,o),t.getView().fit(n.config.project_extent,t.getSize())}},{title:"Print output creation",icon:"printer",toggleGroup:"1",disabled:!0},{title:"Draw points, lines, polygons",icon:"pen",toggleGroup:"2",disabled:!0},{title:"Search features by attributes",icon:"binocular",toggleGroup:"1",activate:function(){},deactivate:function(){}},{title:"Identify features by mouse click",icon:"circle-i",toggleGroup:"1",activate:function(){var e;this.mapClickListener=n.map.on("singleclick",function(o){var i=n.map.getLayer("qgislayer").getSource(),a=this.identificationLayer?[this.identificationLayer]:i.getVisibleLayers(),r=i.getGetFeatureInfoUrl(n.map,o.pixel,a),u=[];a.forEach(function(t){u.push("qgs:"+t.replace(" ",""))}),c.get(r).then(function(o){var i=new ol.format.GML2({featureNS:{qgs:"http://qgis.org/gml"},featureType:u}),n=i.readFeatures(o);e?e.setFeatures(n):(e=t.$new(!0,t),e.features=n,s.show({templateUrl:l+"features_panel.html",clickOutsideToClose:!1,disableParentScroll:!1,controller:"FeaturesController",scope:e,parent:".bottom-bar"})["finally"](function(){e.setFeatures([]),e=null}))})},this)},deactivate:function(){n.map.unByKey(this.mapClickListener),s.hide()}}],t.toolClicked=function(e){angular.isFunction(e.action)&&e.action(),e.toggleGroup&&(e.activated||t.tools.forEach(function(t){t.activated&&e!==t&&t.toggleGroup===e.toggleGroup&&(t.activated=!1,t.deactivate())}),e.activated=!e.activated,e.activated?e.activate():e.deactivate())},t.openLeftMenu=function(){i("left").toggle()},c.project(r).then(function(e){t.title=e.root_title,n.load(e),console.log(e);var o=angular.element(document.getElementById("map"));o.css("height",o.parent()[0].scrollHeight+"px"),n.map&&(n.map.setTarget("map"),n.map.getView().fit(e.zoom_extent,n.map.getSize()),n.map.addControl(new ol.control.ScaleLine),t.project=n)})}angular.module("gl.web").controller("AppController",t).config(["$mdIconProvider","resourcesRoot",function(t,e){t.defaultIconSet(e+"styles/icons.svg",32)}]),t.$inject=["$scope","$timeout","$q","$mdSidenav","projectProvider","layersControl","projectPath","resourcesRoot","gislabClient","$mdBottomSheet"]}();
!function(){"use strict";function e(){this.config={}}function t(e,t,r){function n(){this.currentRequest=null,this.serverUrl=e.server||""}return n.prototype._deferredRequest=function(e){var n=r.defer(),o=angular.extend({timeout:n.promise},e),s=t(o),i=s.then(function(e){return e.headers("X-GIS.lab-Version")?e.data:r.reject({invalid_server:!0,canceled:!1})},function(e){return r.reject({invalid_server:e.headers("X-GIS.lab-Version")?!1:!0,canceled:i.canceled===!0,status_code:e.status})});return i.abort=function(){i.canceled=!0,n.resolve()},i["finally"](function(){i.abort=angular.noop,n=s=i=null}),this.currentRequest=i,i},n.prototype.abortRequest=function(){this.currentRequest&&this.currentRequest.abort&&this.currentRequest.abort()},n.prototype.login=function(e,t,n){return t&&n?(this._secure=!0,this.serverUrl="https://{0}".format(e),this._deferredRequest({url:"{0}/mobile/login/".format(this.serverUrl),method:"post",withCredentials:!0,data:{username:t,password:n}})):(this._secure=!1,this.serverUrl="http://{0}".format(e),r.when())},n.prototype.logout=function(){return this.serverUrl?this._deferredRequest({url:"{0}/mobile/logout/".format(this.serverUrl),withCredentials:!0}):r.when()},n.prototype.project=function(e){var t;return t=e&&"empty"!==e?"{0}/mobile/config.json?PROJECT={1}".format(this.serverUrl,encodeURIComponent(e)):"{0}/mobile/config.json?".format(this.serverUrl),this._deferredRequest({url:t,method:"get",withCredentials:!0})},n.prototype.userProjects=function(){return this._deferredRequest({url:"{0}/projects.json".format(this.serverUrl),method:"get",withCredentials:!0})},n.prototype.get=function(e){return this._deferredRequest({url:e,method:"get",withCredentials:!0})},new n}angular.module("gl.web").config(["$httpProvider",function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",e.defaults.transformRequest.unshift(function(e){var t,r=[];for(t in e)e.hasOwnProperty(t)&&r.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return r.join("&")})}]).provider("gislabClient",e),e.prototype.configure=function(e){this.config=e},e.prototype.$get=["$http","$q",function(e,r){return new t(this.config,e,r)}]}();