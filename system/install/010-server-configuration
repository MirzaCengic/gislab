#
### BASIC SERVER CONFIGURATION ###
#

# Read server IP from running server and update GISLAB_NETWORK. This is done because some 
# cloud providers like AWS ignore IP address given by Vagrantfile and set it by their own.
GISLAB_SERVER_IP=$(hostname  -I | awk -F" " '{print $NF}')
GISLAB_NETWORK=$(echo $GISLAB_SERVER_IP | awk -F "." '{ print $1 "." $2 "." $3 }')

# set FQDN to 'server.gis.lab' if not given by cloud provider at start (AWS)
if [ "$GISLAB_SERVER_PROVIDER" == "aws" ]; then
	hostname=$(hostname)
	hostname_fqdn=$(hostname --fqdn)
else
	hostname="server"
	hostname_fqdn="server.gis.lab"
fi
sed -i "/^127.0.0.1 localhost/a $GISLAB_SERVER_IP $hostname_fqdn $hostname" /etc/hosts
cat << EOF > /etc/hostname
$hostname
EOF
service hostname start
service rsyslog restart # restart syslog to read new hostname


# timezone
cat << EOF > /etc/timezone
$GISLAB_TIMEZONE
EOF

dpkg-reconfigure --frontend noninteractive tzdata


# locales
export LANGUAGE=en_US.UTF-8
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export LC_CTYPE=en_US.UTF-8
locale-gen en_US.UTF-8

cat << EOF > /etc/default/locale
LANG="en_US.UTF-8"
LANGUAGE="en_US:en"
EOF

# sudoers
sed -i 's/secure_path.*/secure_path="\/usr\/local\/sbin:\/usr\/local\/bin:\/usr\/sbin:\/usr\/bin:\/sbin:\/bin:\/vagrant\/system\/bin"/g' /etc/sudoers
echo "PATH="$PATH:/vagrant/system/bin"" >> /etc/profile


# vim: set syntax=sh ts=4 sts=4 sw=4 noet:
